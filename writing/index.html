<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/index.css" />
    <link rel="icon" type="image/png" href="./favicon.png" />
    <title>Mike - Portfolio</title>
  </head>

  <!-- <body onload="getUsers()"> -->
  <body>
    <nav class="navbar">
      <ul class="navigation">
        <li class="navigation__item">
          <a class="navigation__link nonSelectedTap" href="/">start</a>
        </li>
        <li class="navigation__item">
          <a class="navigation__link nonSelectedTap" href="/about">about</a>
        </li>
        <li class="navigation__item">
          <a class="navigation__link" href="/writing">writing</a>
        </li>
        <li class="navigation__item">
          <a class="navigation__link nonSelectedTap" href="/say_hi">say_hi</a>
        </li>
      </ul>
      <a class="nav_btn" href="https://twitter.com/" target="_blank"
        >twitter (x)
      </a>
    </nav>
    <hr />
    <img class="headline_img" src="../img/Asset 3.png" alt="Headline" />
    <h1 class="headline">CREWMATEJ</h1>
    <hr />
  <!-- HERE POST WILL BE LOAD FROM JAVASCRIPT -->
    <!-- <section id="posts"></section> -->


    <section id="posts">
      <div style="display: block" class="body__section">
        <div class="body_top body_top--writing">
          <h1><input class="body__checkbox" type="checkbox">CREWMATEJ</h1>
          <a style="text-transform: lowercase" href="#">The post-fundamentals era of crypto investing</a>
          <p>08/17/2023 (Thu) 2:23:00</p>
          <p>No. 1</p>
        </div>
        <div id="post-content"><p>So it seems there‚Äôs somewhat of a consensus that crypto is in its post-fundamentals era. That it doesn‚Äôt matter what the technology related to the token could become; because on a long enough time horizon, no token-holder has ever been rewarded for holding. The only ‚Äòfundamentals‚Äô a token will need is other&nbsp;buyers.</p><p>and I‚Äôm not saying this hasn‚Äôt always been the case, it just feels more broadly realised now. There‚Äôs an acknowledgement that we can‚Äôt sell narratives of governance, potential rev-share, staking, and all that, because they‚Äôve all been exhausted.</p><p>I‚Äôve barely held any tokens with conviction since November 2021. It‚Äôs not my niche. I missed Defi Summer but I remember being partially red-pilled on the prospects of $UNI and all the Defi tokens throughout 2022, listening to old podcasts, reading old blogs, all that junk. The endgame for these tokens was supposedly to share protocol revenue and governance rights. The token holders would be partial owners of the world‚Äôs largest cross-border asset exchange.</p><p>Now almost everyone is aware the main purpose of a token is for the team and investors to cashout. So any narratives about fundamentals that are spun up are&nbsp;futile.</p><p>In this post-fundamentals era for crypto, coins like Pepe and HarryPotterObamicSonic10Inu are being genuinely considered on my TL as the best allocation for the next cycle. Because they contain culture. Or at least, enough culture to sell to the greater fool at a higher&nbsp;mcap.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*mD_yqMbsgqObRYN164P5Jw.png"></figure><p>Culture is definitely important‚Ää‚Äî‚Ääit‚Äôs partly, if not entirely, the reason Milady is so successful. All the other PFPs are bleeding at the moment, except for the Remila eco ones. They aren‚Äôt any more fundamentally sound than any of the other PFPs, just like all the others there‚Äôs no hard asset backing them. There‚Äôs been airdrops for a while, sure, (thinking of Scatter Art, $DMT, and others here), but it‚Äôs minimal and at this point everyone can acknowledge airdrops are relatively zero&nbsp;sum.</p><p>Milady has been the right cultural fit for crypto for some time. In good cause from the team too, who are very much self-aware drivers of it. The tweets of the Charlotte and co and the large success of their events are testimony to&nbsp;this.</p><iframe src="https://cdn.embedly.com/widgets/media.html?type=text%2Fhtml&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;schema=twitter&amp;url=https%3A//twitter.com/REMILIONAIRE/status/1690229546304565248&amp;image=https%3A//i.embed.ly/1/image%3Furl%3Dhttps%253A%252F%252Fabs.twimg.com%252Ferrors%252Flogo46x38.png%26key%3Da19fcc184b9711e1b4764040d3dc5c07" allowfullscreen="" frameborder="0" height="281" width="500" title="Remilio Babies üöÄ on Twitter: &quot;fuxkkk bro i just got drained got my fuckin nuts drained down to the sack / Twitter&quot;" class="eh n ei rj bg" scrolling="no"></iframe><p>You could even go so far to say the cultural value is ‚Äòfundamental‚Äô value. That people will read your tweets if you don a Remilia&nbsp;PFP.</p><p>Imo though, ultimately, the shitcoin cycle we are in at the moment is just another narrative. How far this narrative goes is defined by how high Hpos10i goes, or Pepe, or the next coin that hasn‚Äôt arrived yet. It could well succeed in a bigger bull when majors pump more. But to reiterate: end of the day, it is still a narrative.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*K66UrdHOeWtqUzQyA0pDMQ.png"></figure><p>Also imo, the return value on fundamentals will come eventually if crypto innovates. People will no longer end up with wool over their eyes though; we need actual fundamentals. $GMX and $RLB to name two, but they both contain long-tail protocol-level bankruptcy risk. We need more useful on-chain primitives, better self custody solutions, greater connections to real world assets, and more. Probably a lot of what we need, we don‚Äôt even know&nbsp;yet.</p><p>and with the return to fundamentals we might just see a rejection of the memecoins born in the post-fundamentals era.</p><p>Would highly recommend reading @CL207‚Äôs article that first made me seriously aware of the longevity of shitcoin&nbsp;szn.</p><p><a href="https://www.egirlcapital.com/writings/154108440">https://www.egirlcapital.com/writings/154108440</a>.</p><p>Perhaps my view is more optimistic, that within crypto we might see a reversion to value on fundamentals.</p><p>Thanks for&nbsp;reading.</p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=f0b6bb77af80" width="1" height="1" alt=""></div>
      </div>
      <hr>
      
      <div style="display: block" class="body__section">
        <div class="body_top body_top--writing">
          <h1><input class="body__checkbox" type="checkbox">CREWMATEJ</h1>
          <a style="text-transform: lowercase" href="#">How to find Uniswap v3 TWAP using Etherscan</a>
          <p>07/26/2023 (Wed) 2:14:04</p>
          <p>No. 2</p>
        </div>
        <div id="post-content"><p>I recently realised not everyone is aware that Uniswap v3 has a TWAP feature baked right into it. To be honest I never gave it too much thought, but was reminded of it last year when completing <a href="https://www.damnvulnerabledefi.xyz/challenges/puppet-v3/">Damn Vulnerable Defi Challenge #14</a>.</p><p>In my opinion, the existence of the Uniswap TWAP is pretty significant. We often can‚Äôt have a Chainlink oracle for small pairs, so this TWAP may be the only decentralised option. The fact that it is a TWAP is also important in that it is more resistant to flash-loan attacks than the simple spot&nbsp;oracle.</p><p>A use-case for the TWAP could be that it is used in a lending protocol that wants to allow permissionless loans on *any* Uniswap pair, not just whitelisted pairs. The exact implementation would need to be fleshed out more, but it is a simple high-level example.</p><p>Anyways, let‚Äôs run through how we can find the TWAP for the past hour on the FUMO/WETH pair (0x78d4e81fc84a1ce367e90936e49a74a9052137e8).</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*LOwzFZIfd6Dyeb4T_G50BQ.png"><figcaption><a href="https://etherscan.io/address/0x78d4e81fc84a1ce367e90936e49a74a9052137e8#readContract">Etherscan</a></figcaption></figure><p>If we look at the `observe` function, and put in the array [0,3600], we receive data from 0 seconds ago and 1 hour&nbsp;ago.</p><p>The math to find the TWAP for this period is as&nbsp;follows:</p><p>1.0001 ** ((55811710140‚Äì55738177572) / 3600) = 7.7096 (price in&nbsp;WETH)</p><p>Convert to USD (ETH@1898.39)</p><p>7.7096 * 1898.39 = 14635.8275</p><p>I checked Dextools and this was around the current price&nbsp;üëç</p><p>Current time is 2023/07/20 00:15:00&nbsp;(UTC+9)</p><p>It may not always work for a longer time interval of 1 hour (3600s), because the contract can only store a limited amount of data. If you want to know the reason why, I‚Äôd suggest reading deeper into the docs. Also feel free to ask&nbsp;me.</p><p>That‚Äôs the high level overview of finding the TWAP. Remember, the quiddity of this is that everything I did above can all be done on-chain in real time, which is incredibly powerful.</p><p>It is worth noting there are still theoretical ways to manipulate the TWAP. An example for a larger liquidity pool:</p><p><a href="https://blog.uniswap.org/uniswap-v3-oracles">https://blog.uniswap.org/uniswap-v3-oracles</a></p><p>In lower liquidity pools, which may be used for the permissionless lending protocol example I gave before, the implementation needs to be thorough since there will be more edge cases to consider. For example, if the lending protocol used a 10 minute TWAP, a whale could simply dump the price and hope that any vigilant buyers aren‚Äôt watching the market at the&nbsp;time.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/999/1*7CcFREMxZj6ZaIsfKWKIfw.jpeg"></figure><p>Class concluded, thanks for coming. Feedback and all else is appreciated‚Ää‚Äî‚ÄäI check my Twitter DMs regularly.</p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=66af779cd7b8" width="1" height="1" alt=""></div>
      </div>
      <hr>
      
      <div style="display: block" class="body__section">
        <div class="body_top body_top--writing">
          <h1><input class="body__checkbox" type="checkbox">CREWMATEJ</h1>
          <a style="text-transform: lowercase" href="#">Buying NFT capitulation: a theorem</a>
          <p>07/10/2023 (Mon) 5:36:48</p>
          <p>No. 3</p>
        </div>
        <div id="post-content"><p>Recently we have seen record-breaking NFT liquidations, with both lenders and borrowers losing&nbsp;money.</p><iframe src="https://cdn.embedly.com/widgets/media.html?type=text%2Fhtml&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;schema=twitter&amp;url=https%3A//twitter.com/CirrusNFT/status/1675972560020967424&amp;image=https%3A//i.embed.ly/1/image%3Furl%3Dhttps%253A%252F%252Fabs.twimg.com%252Ferrors%252Flogo46x38.png%26key%3Da19fcc184b9711e1b4764040d3dc5c07" allowfullscreen="" frameborder="0" height="696" width="680" title="Cirrus on Twitter: &quot;Over the last few days, we've seen the worst liquidation cascade in the history of NFTs and its not really closeThere were 1244 Liquidations in the last 96 hours (This excludes forced sellers that sold their collateral to repay loans before they were underwater)For reference... pic.twitter.com/3cpy8tDHi5 / Twitter&quot;" class="eh n ei rq bg" scrolling="no"></iframe><p>At some point surely the liquidations stop and price will recover to some extent. I‚Äôve been doing some thinking‚Ää‚Äî‚Äähow can this be modelled, and more importantly, how can I profit off&nbsp;this?</p><p>I have a theorem of sorts I thought of a while ago, which may or may not already formally exist. In this article I‚Äôll try explain it and apply it to the theory of NFT capitulation.</p><p>Let‚Äôs paint a scenario: Bored Apes are at 40Œû, machibigbrother.eth instantly dumps 100 apes into the Blur bidding pool, and this drags the price down to&nbsp;30Œû.</p><p>Let‚Äôs assume there has been no price-changing news, and Machi is the only seller. Assume also there are 10 passionate buyers of Bored Apes. We don‚Äôt know the prices they are willing to buy at; assume they haven‚Äôt placed any bids for us to see. Assume <strong>they will all become aware of the new price at different times</strong>. A visual example is shown&nbsp;below.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*SI9hf0yp8aFEoS2DmcP-Ow.png"><figcaption>Potential buyers at different times</figcaption></figure><p>By t=3, 9/10 buyers have become aware of the new price. If the price has moved up, it‚Äôs because some of these 9 buyers believe that 30Œû is a reasonable entry point. Some might even believe 31Œû, 32Œû, 33Œû, 34Œû, are all good price points to buy. If this is the case, buying at t=0 was a smart decision since you could sell higher to these passionate buyers.</p><p>If none of the 9 buyers want to buy at 30Œû, and you bought at 30Œû, you can simply resell at breakeven or a small loss. We can see that Machi‚Äôs wallet has no more apes to sell. So whether or not we have buyers at 30Œû, the overall expected value makes it a smart decision to buy Machi‚Äôs instant capitulation to&nbsp;30Œû.</p><p>Of course, this is grossly oversimplified in comparison to reality. For a larger population, and more randomness around when each buyer has noticed the new price, we could model the expected percentage of potential buyers (y-axis) that have seen the new price at time t (x-axis).</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/640/1*pqewLznDvL-ngUAqI6u1kA.png"><figcaption><a href="https://blogs.sas.com/content/iml/2015/03/04/approximate-cdf.html">https://blogs.sas.com/content/iml/2015/03/04/approximate-cdf.html</a></figcaption></figure><p>It may not necessarily be the curve of this lognormal CDF, but it illustrates the&nbsp;point.</p><p><em>At a certain time t=k, we can assume most buyers have seen the new&nbsp;price</em></p><p>At t=k we can assume price has adjusted accordingly, by either staying the same or moving up as described above. If we bought at t=0 it would make sense to sell at&nbsp;t=k.</p><p>We might be able to estimate the time <em>k</em> based on previous data, scrolling Twitter and Discord, or even just intuition.</p><p>This is still very much oversimplified, since in reality we might find new sellers at 30Œû that were planning to hold at 40Œû, or we might have other traders competing to buy at 30Œû. But it is a framework that can be used, especially when it is only one wallet that is dumping the NFTs (which is often the&nbsp;case).</p><p>Mean-reversion is not a new phenomenon; moving averages have been used as indicators for ages. But the NFT market is still very inefficient due to a concoction of illiquidity, lack of charts, and irrational participants (this is crypto after&nbsp;all).</p><p>Let‚Äôs take the example of Mando (@rektmando) and OSF (@osf_rekt) dumping apes into the Blur bidding pool (February 22,&nbsp;2023).</p><iframe src="https://cdn.embedly.com/widgets/media.html?type=text%2Fhtml&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;schema=twitter&amp;url=https%3A//twitter.com/liamherbst_/status/1629199163236777984&amp;image=https%3A//i.embed.ly/1/image%3Furl%3Dhttps%253A%252F%252Fabs.twimg.com%252Ferrors%252Flogo46x38.png%26key%3Da19fcc184b9711e1b4764040d3dc5c07" allowfullscreen="" frameborder="0" height="803" width="680" title="Herbie on Twitter: &quot;The BAYC bid wall is down from 78 ETH to 60 ETH since the Mando sale.Machi is still holding almost all of the apes and the 63 ETH bid is from them.BendDAO liquidations will begin if we hit 65 ETH. pic.twitter.com/MHbr7gjOqz / Twitter&quot;" class="eh n ei rq bg" scrolling="no"></iframe><p>The capitulation wasn‚Äôt instant since they sold into a thick wall of Blur bids, but price spiralled shortly after they sold as bidders played hot potato to offload Apes they never wanted to buy in the first place. The graph shows a nice illustration of how it played out (pinned on the axes are the price and rough time of&nbsp;sale).</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*fY9RXeJ0z533P1cZ6qqBeA.png"></figure><p>Another example is GCR (@GCRClassic) selling a few hundred Miladys. Again, price and rough time of sale are pinned. The bottom only a few hours after he sold was noticeable since he was selling in multiple transactions over an hour or so. Although he still had some Miladys left, the selling transactions stopped.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/718/1*7qc23-DpyphXY6S-TRopXw.png"></figure><p>Anyways, food for thought, I‚Äôm sure this theorem or a variation has a name somewhere. Keep it in mind and don‚Äôt be afraid to buy ugly JPEGs to sell upon mean-reversion.</p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=6f3765ecfc69" width="1" height="1" alt=""></div>
      </div>
      <hr>
      
      <div style="display: block" class="body__section">
        <div class="body_top body_top--writing">
          <h1><input class="body__checkbox" type="checkbox">CREWMATEJ</h1>
          <a style="text-transform: lowercase" href="#">Picking Up Pennies from Uninitialised Implementation Contracts</a>
          <p>05/17/2023 (Wed) 9:48:56</p>
          <p>No. 4</p>
        </div>
        <div id="post-content"><p><strong>NB: article was written in Feb 2023, albeit published in May&nbsp;2023</strong></p><p>A <a href="https://twitter.com/0xCygaar/status/1620496240445378561">post</a> by 0xCygaar a few weeks ago explained how he took control of the Qzuki implementation contract. Only a few days later I saw he took control of <a href="https://twitter.com/0xCygaar/status/1621417995905167360">another</a> NFT project‚Äôs implementation contract! It got me thinking‚Ä¶ could I do this&nbsp;myself?</p><h3>Proxies?</h3><p>If you don‚Äôt know how proxy contracts work, this article may not make sense‚Ää‚Äî‚ÄäI would suggest reading up on them quickly, specifically the Transparent Upgradeable Proxy&nbsp;pattern.</p><p>If you can‚Äôt be bothered, just use the diagram below for reference:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*En8LeDbGobMMB0IvePyicQ.png"><figcaption><a href="https://www.certik.com/resources/blog/FnfYrOCsy3MG9s9gixfbJ-upgradeable-proxy-contract-security-best-practices">https://www.certik.com/resources/blog/FnfYrOCsy3MG9s9gixfbJ-upgradeable-proxy-contract-security-best-practices</a></figcaption></figure><p>In essence, proxies exist so the user only ever has to interact with the Proxy contract, but devs can still change the Implementation contract. The devs can ‚Äòupgrade‚Äô the contract logic, without rocking the (figurative) boat of the whole&nbsp;system.</p><p>Most on-chain participants would have interacted with a proxy pattern before, and may even recognise the name Transparent Upgradeable Proxy from Etherscan‚Äôs labels:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*QBrvxy4bg4tF5n4XNkzRqQ.png"></figure><h3>Back to my&nbsp;question</h3><p>Could I find any implementation contracts to take ownership of? Over the next few days, I checked every Transparent Upgradeable Proxy contract I&nbsp;saw.</p><p>To my surprise, it was very common for projects to forget to initialise their implementation contract. If a contract is uninitialised, it often means <em>anyone </em>can call the initialize()function and take ownership.</p><p>While it‚Äôs not a very high-risk mistake, it could<em> </em>have negative effects for users. If an attacker took control over the implementation contract, they could deploy some phishing attempts under the guise of the original contract deployer. 0xCygaar‚Äôs post talks a bit about&nbsp;this.</p><p>Another problem is, if users accidentally send ETH to the implementation contract, someone else may be able to yoink&nbsp;it.</p><p>Yoinkage is exactly what I have attempted.</p><p>I searched the Ethereum mainnet for Transparent Upgradeable Proxies and their implementation contract, to see if any projects have left ETH in uninitialised implementation addresses.</p><h3>The Process</h3><ul><li>scan the chain for the Upgraded(address implementation) event, the hash&nbsp;is:</li></ul><blockquote>0xbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b</blockquote><ul><li>Etherscan‚Äôs API allows you to query events in a specified block range regardless of contract address. Below is what the Upgraded event typically looks like. The implementation address is in topics[1] (it‚Äôs padded with&nbsp;0s).</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*tYtL7IVf9YCYsWbpWFmDdA.png"></figure><ul><li>once I had the implementation addresses I filtered by ETH balance and token&nbsp;balances</li><li>If a contract was uninitialised and contained ETH, I‚Äôd check for the initialize() and withdraw() functions, then try call them. Some contracts also have a withdrawToken() function.</li></ul><p>You can often tell a contract is uninitialised if the owner returns 0x00..00.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*4VZbNouGraFEh6Run6SJNw.png"></figure><h3>In Summary</h3><p>Well, all that and I only got 0.06 ETH ($100) from one contract&nbsp;-_-</p><p>There were a few unverified contracts with $30‚Äì40 in them but after gas I‚Äôm sure it wouldn‚Äôt be worth&nbsp;it.</p><p>Some things I did&nbsp;find:</p><ul><li>The ‚ÄúBlur Pool contract 0x17584a148d27ac5d06d87771464dacbaf625ce45 has 0.0205 ETH stuck in it but they used the correct measures to prevent anyone from initialising the contract:</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/871/1*Z-YTi5YQdpzVTgSQ228eAw.png"></figure><ul><li>The Covan Cats implementation contract 0x443df53788d483a33a2aaeb8e6f02b78752090c2 has 0.55e stuck in it&nbsp;o_o</li><li>This contract here is uninitialised with 0.05e and 50 DAI, but there doesn‚Äôt seem to be a way to initialise it‚Ä¶ 0x939bde6c3495f8b5caa9b9ededec1bc63b35c1fe.</li></ul><p>That‚Äôs it, thanks for&nbsp;reading!</p><p>I hope this inspired some teams to initialise their implementation contracts, so if users accidentally send ETH to them, that ETH can be easily recovered.</p><p>Oh, and I‚Äôve already checked most other major EVM chains for yoinkage, I found nothing&nbsp;://</p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=ecfa5592d58" width="1" height="1" alt=""><hr><p><a href="https://coinsbench.com/picking-up-pennies-from-uninitialised-implementation-contracts-ecfa5592d58">Picking Up Pennies from Uninitialised Implementation Contracts</a> was originally published in <a href="https://coinsbench.com">CoinsBench</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p></div>
      </div>
      <hr>
      
      <div style="display: block" class="body__section">
        <div class="body_top body_top--writing">
          <h1><input class="body__checkbox" type="checkbox">CREWMATEJ</h1>
          <a style="text-transform: lowercase" href="#">Replay Attacks, Self-destructing Contracts, and Ethereum‚Äôs Memory Layout: What I Learned From‚Ä¶</a>
          <p>02/22/2023 (Wed) 6:50:39</p>
          <p>No. 5</p>
        </div>
        <div id="post-content"><h3>Replay Attacks, Self-destructing Contracts, and Ethereum‚Äôs Memory Layout: What I Learned From Completing Damn Vulnerable Defi Challenge #13 ‚ÄòWallet&nbsp;Mining‚Äô</h3><p>Since early December, I have been obsessed with the challenges over at <a href="http://damnvulnerabledefi.xyz">damnvulnerabledefi.xyz</a>&nbsp;. They have taken my knowledge of DeFi and smart contracts to the next level, to say the least. After I completed the first twelve challenges by early January, I was very happy to hear that @<a href="https://twitter.com/tinchoabbate">tinchoabatte</a> had just released three more challenges!</p><p>Challenge #13 was most definitely the hardest, and it took me about a week to finish. Here is how I completed it, and what I learnt in the process. Keep in mind, many of the concepts used to complete this challenge I was learning for the first time. For more experienced blockchain developers, I imagine this challenge could be completed in 1‚Äì2&nbsp;hours.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*vPo8LodkzZXPxhMofDh4OQ.png"><figcaption><a href="https://www.damnvulnerabledefi.xyz/challenges/wallet-mining/">https://www.damnvulnerabledefi.xyz/challenges/wallet-mining/</a></figcaption></figure><p>For context, I had already completed Challenge 11 so I had a decent understanding of the Gnosis contracts already. The most helpful resource I found was <a href="https://www.youtube.com/watch?v=_2ZJ5HBEfUk&amp;t=1854s&amp;ab_channel=dearesthui">this&nbsp;video</a>.</p><p>After reading the problem, I knew the first and most obvious step would be to deploy the Gnosis contracts onto this new chain. I had just recently read <a href="https://twitter.com/0xfoobar">@0xfoobar</a>‚Äôs <a href="https://0xfoobar.substack.com/p/vanity-addresses">article on vanity addresses</a>, so I was aware that it was possible to replicate contract addresses on new&nbsp;chains.</p><p>Here is a snippet from the article that I used as my first&nbsp;lead:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/777/1*oaYM3U-xKVKRi-l97wX38A.png"></figure><p>The article explains that smart contract addresses can be kept consistent across chains by using CREATE2 and keeping the ‚Äòsender‚Äô variable constant by deploying via a smart contract. I was able to quickly disregard this thesis through Etherscan, by seeing that the deployments for the Gnosis contracts 0x34CfAC646f301356fAa8B21e94227e3583Fe3F5F and 0x76E2cFc1F5Fa8F6a5b3fC4c8F4788F0116861F9B were performed via an EOA, not a contract.</p><p>The article also nods at keyless transactions, which was another rabbit-hole I went down by reading <a href="https://yamenmerhi.medium.com/nicks-method-ethereum-keyless-execution-168a6659479c">this article</a>. This theory was also disregarded since the EOA that deployed each contract had completed other transactions.</p><p>I was at a bit of a loss so I headed to the Github repo for clues, where I found&nbsp;this:</p><p><em>‚ÄúAlso, the scenario presented in the challenge is quite similar to an issue that happened not so long&nbsp;ago.‚Äù</em></p><p>The first thing I thought of was the Optimism hack in June last year, where 20 million OP tokens were sent to the wrong address but recovered by a white-hat through a replay attack. But I thought replay attacks were a thing of the past post&nbsp;EIP-155?</p><p>As it turns out, a transaction can be replicated across chains post EIP-155 if the transaction is submitted with a chain ID of zero (instead of the typical 1 for mainnet). I couldn‚Äôt find the chain ID on Etherscan but was able to quickly find it using&nbsp;this:</p><pre>const tx = await provider.getTransaction(TX_HASH);<br>console.log('Chain ID is: ', tx.chainId);</pre><p>For both deployment transactions 0x06d2fa464546e99d2147e1fc997ddb624cec9c8c5e25a050cc381ee8a384eed3 and 0x75a42f240d229518979199f56cd7c82e4fc1f1a20ad9a4864c635354b4a34261 the chain ID was zero. These transactions were sent by 0x1aa7451dd11b8cb16ac089ed7fe05efa00100a6a and had a nonce of 0 and 2 respectively, so I had to check the chain ID of the transaction with nonce 1 on that EOA‚Ää‚Äî‚Ääwhich I found also had a chain ID of&nbsp;0.</p><p>With this knowledge, I knew I could replicate these transactions even though I didn‚Äôt have the private key to the Gnosis Safe Deployer wallet 0x1aa7451dd11b8cb16ac089ed7fe05efa00100a6a.</p><p>So I had the first hurdle out of the way, now I needed to complete the rest of the challenge. The fact that the challenge name was ‚ÄòWallet Mining‚Äô and that 20 million tokens were stored in an empty address 0x9b6fb606a9f5789444c17768c6dfcf2f83563801 was enough of a hint for&nbsp;me.</p><p>The solution is that the 43rd Gnosis Safe that gets deployed via the WalletDeployer contract is this address. By making the wallet a 1-of-1 multi-sig and setting myself as the only owner, I could safely execute a transfer of the tokens out of this wallet. In fact, it even didn‚Äôt matter who the owners of the multi-sig were since I could execute the transfer within the ‚Äòsetup‚Äô function of the MasterCopy contract.</p><pre>/// Source: https://etherscan.deth.net/address/0x34CfAC646f301356fAa8B21e94227e3583Fe3F5F<br><br>/// @dev Setup function sets initial storage of contract.<br>/// @param _owners List of Safe owners.<br>/// @param _threshold Number of required confirmations for a Safe transaction.<br>/// @param to Contract address for optional delegate call.<br>/// @param data Data payload for optional delegate call.<br>/// @param fallbackHandler Handler for fallback calls to this contract<br>/// @param paymentToken Token that should be used for the payment (0 is ETH)<br>/// @param payment Value that should be paid<br>/// @param paymentReceiver Adddress that should receive the payment (or 0 if tx.origin)<br>function setup(<br>    address[] calldata _owners,<br>    uint256 _threshold,<br>    address to,<br>    bytes calldata data,<br>    address fallbackHandler,<br>    address paymentToken,<br>    uint256 payment,<br>    address payable paymentReceiver<br>) external {<br>  /// ...<br>  /// ...<br>  /// ...<br>}</pre><p>So I had the 20 million tokens, but there were still some tokens in the WalletDeployer contract‚Ää‚Äî‚Ää43 to be exact. I probably should have called it a day here and walked home with the 20 million tokens I had already stolen. But I wanted to complete the challenge!</p><p>I spent at least two days reading all about Solidity‚Äôs low-level assembly language just to understand the function in WalletDeployer.sol‚Ää‚Äî‚Ääpart of this was learning the official memory layout for Solidity, through the&nbsp;<a href="https://docs.soliditylang.org/en/v0.8.4/internals/layout_in_memory.html">docs</a>.</p><pre>// TODO(0xth3g450pt1m1z0r) put some comments<br>function can(address u, address a) public view returns (bool) {<br>    assembly { <br>        let m := sload(0)<br>        if iszero(extcodesize(m)) {return(0, 0)}<br>        let p := mload(0x40)<br>        mstore(0x40,add(p,0x44))<br>        mstore(p,shl(0xe0,0x4538c4eb))<br>        mstore(add(p,0x04),u)<br>        mstore(add(p,0x24),a)<br>        if iszero(staticcall(gas(),m,p,0x44,p,0x20)) {return(0,0)} <br>        if and(not(iszero(returndatasize())), iszero(mload(p))) {return(0,0)}<br>    }<br>    return true;<br>}</pre><p>Even after understanding what is going on here, I couldn‚Äôt see exactly where the exploit&nbsp;was.</p><p>I did have some leads though. The problem explicitly mentions that AuthorizerUpgradeable.sol uses an upgradeable mechanism‚Ää‚Äî‚Ääthe UUPS proxy pattern. I recalled reading a <a href="https://twitter.com/0xCygaar/status/1620496240445378561">post by @0xCygaar</a> about how he took control of the Qzuki implementation contract. However Qzuki used the Transparent Upgradeable Proxy pattern. I also remembered reading in the comments of this post that a vulnerability in UUPS proxies is that an attacker can take ownership, upgrade, then call a self-destruct function on the implementation contract.</p><p>Thinking about this, we can see how all the checks in the assembly block can be passed. I needn‚Äôt explain all them here, but if you review <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/proxy/Proxy.sol">Proxy.sol</a>you may be able to understand how this is the&nbsp;case.</p><p>So that‚Äôs about it, once we know we can force the ‚Äòcan‚Äô function to return true, we can be payed 1 token for each deployment we make. Deploy 43 more Gnosis Safes, and we have officially taken all the&nbsp;tokens.</p><p>Ideally we would do the whole self-destruct-the-implementation-contract bit first, so that we only had to deploy a total of 43 safes rather than 86, but this was simply the order I found the solution.</p><p>Relevant files I used for the solution can be found at <a href="https://github.com/crewmateJ/damn-vulnerable-defi-13">https://github.com/crewmateJ/damn-vulnerable-defi-13</a></p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=4b8fc0953848" width="1" height="1" alt=""></div>
      </div>
      <hr>
      </section>


    <script
      async
      src="https://platform.twitter.com/widgets.js"
      charset="utf-8"
    ></script>
    <footer>
      <hr />
      <p>bottom text here</p>
    </footer>
  </body>
  <script src="/index.js"></script>
</html>
